webpackJsonp([4],{KstT:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=a("BO1k"),o=a.n(i),n=a("mvHQ"),d=a.n(n),c={data:function(){return{form:{name:"",price:"",standard:"",description:""},uploadUrl:"https://www.njhaoji.com/product/product_image/",uploaded:[],picIds:[],chooseChangedPicId:"",chooseChangedPicIndex:"",product_id:"",picUrl:"./static/img/default.jpg"}},methods:{deletePic:function(t){var e=this;this.$axios.delete("/product/product_image/"+this.picIds[t]+"/",{params:{login_token:localStorage.getItem("token")}}).then(function(a){0==a.data.status?(e.$notify({title:"成功",message:"删除成功",offset:0,duration:1500}),e.uploaded.splice(t,1),e.picIds.splice(t,1)):e.$notify({title:"错误",message:a.data.msg,offset:0,duration:1500})}).catch(function(t){this.$notify({title:"错误",message:"服务器繁忙",offset:0,duration:1500})})},onSubmit:function(){var t=this;if(this.form.name){if(isNaN(this.form.price))return this.$notify({title:"错误",message:"商品价格请填写数字",offset:0,duration:2500}),void(this.form.price="");var e=JSON.parse(d()(this.form));e.login_token=localStorage.getItem("token"),this.$axios.post("/product/product_info/"+this.product_id+"/",e).then(function(e){0==e.data.status?t.$notify({title:"成功",message:"保存成功",offset:0,duration:1500}):t.$notify({title:"错误",message:e.data.msg,offset:0,duration:1500})}).catch(function(t){this.$notify({title:"错误",message:"服务器繁忙",offset:0,duration:1500})})}else this.$notify({title:"错误",message:"您必须填写商品名称",offset:0,duration:2500})},upload_pic:function(){document.getElementById("func").click()},change_pic:function(t,e){document.getElementById("func1").click(),this.chooseChangedPicId=t,this.chooseChangedPicIndex=e},change_img:function(t){var e=this,a=this,i=t.target.files[0];if(i.size<1e5){new FileReader;if("jpg"!=(d=i.name.substring(i.name.lastIndexOf(".")+1).toLowerCase())&&"jpeg"!=d&&"pdf"!=d&&"png"!=d&&"dwg"!=d&&"gif"!=d)return void this.$notify({title:"错误",message:"请上传图片格式",offset:0,duration:1500});var o=new FormData;o.append("image",i,i.name),o.append("login_token",localStorage.getItem("token")),o.append("product_id",this.product_id);var n=this.$loading({lock:!0,text:"Loading",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"});this.$axios.post("/product/product_image/"+a.chooseChangedPicId+"/",o,{headers:{"Content-Type":"multipart/form-data"}}).then(function(t){if(0==t.data.status){var i=window.URL.createObjectURL(document.getElementById("func1").files[0]);a.$set(a.uploaded,a.chooseChangedPicIndex,i);for(var o=document.getElementsByTagName("img"),d=0;d<o.length;d++){var c=o[0].width;o[d].style.height=c/1.3+"px"}n.close(),a.$notify({title:"成功",message:"上传成功",offset:0,duration:1500}),document.getElementById("func").value="",document.getElementById("func1").value=""}else e.$notify({title:"错误",message:res.data.msg,offset:0,duration:1500}),n.close()}).catch(function(t){alert("上传图片出错！"),n.close()})}else{var d;if("jpg"!=(d=i.name.substring(i.name.lastIndexOf(".")+1).toLowerCase())&&"jpeg"!=d&&"pdf"!=d&&"png"!=d&&"dwg"!=d&&"gif"!=d)return void this.$notify({title:"错误",message:"请上传图片格式",offset:0,duration:1500});document.getElementById("func1").files[0];var c=new FileReader,s=new Image,l=null;0==(l=t.target.files[0]).type.indexOf("image")&&c.readAsDataURL(l),c.onload=function(t){s.src=t.target.result};var r=document.createElement("canvas"),u=r.getContext("2d");s.onload=function(){var t=this.width,e=this.height,i=t,o=e;(t>600||e>600)&&(t/e>1?(i=600,o=Math.round(e/t*600)):(o=600,i=Math.round(t/e*600))),r.width=i,r.height=o,u.clearRect(0,0,i,o),u.drawImage(s,0,0,i,o),r.toBlob(function(t){var e,i=new FileReader;i.onload=function(t){e=t.target.result.split(",");var i=a.$loading({lock:!0,text:"Loading",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"});a.$axios.post("/product/pc/product_image/"+a.chooseChangedPicId+"/",{login_token:localStorage.getItem("token"),product_id:a.product_id,image:e[1]}).then(function(t){if(0==t.data.status){var e=window.URL.createObjectURL(document.getElementById("func1").files[0]);a.$set(a.uploaded,a.chooseChangedPicIndex,e);for(var o=document.getElementsByTagName("img"),n=0;n<o.length;n++){var d=o[0].width;o[n].style.height=d/1.3+"px"}i.close(),a.$notify({title:"成功",message:"上传成功",offset:0,duration:1500}),document.getElementById("func").value="",document.getElementById("func1").value=""}else a.$notify({title:"错误",message:res.data.msg,offset:0,duration:1500}),i.close()}).catch(function(t){alert("上传图片出错！"),i.close()})},i.readAsDataURL(t)},l.type||"image/png")}}},add_img:function(t){var e=this,a=this,i=t.target.files[0];if(i.size<1e5){new FileReader;if("jpg"!=(d=i.name.substring(i.name.lastIndexOf(".")+1).toLowerCase())&&"jpeg"!=d&&"pdf"!=d&&"png"!=d&&"dwg"!=d&&"gif"!=d)return void this.$notify({title:"错误",message:"请上传图片格式",offset:0,duration:1500});var o=new FormData;o.append("image",i,i.name),o.append("login_token",localStorage.getItem("token")),o.append("product_id",this.product_id);var n=this.$loading({lock:!0,text:"Loading",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"});this.$axios.post("/product/product_image/",o,{headers:{"Content-Type":"multipart/form-data"}}).then(function(t){if(0==t.data.status){var a=window.URL.createObjectURL(document.getElementById("func").files[0]);e.uploaded.push(a);for(var i=document.getElementsByTagName("img"),o=0;o<i.length;o++){var d=i[0].width;i[o].style.height=d/1.3+"px"}n.close(),e.$notify({title:"成功",message:"上传成功",offset:0,duration:1500}),document.getElementById("func").value="",document.getElementById("func1").value=""}else e.$notify({title:"错误",message:res.data.msg,offset:0,duration:1500}),n.close()}).catch(function(t){alert("上传图片出错！"),n.close()})}else{var d;if("jpg"!=(d=i.name.substring(i.name.lastIndexOf(".")+1).toLowerCase())&&"jpeg"!=d&&"pdf"!=d&&"png"!=d&&"dwg"!=d&&"gif"!=d)return void this.$notify({title:"错误",message:"请上传图片格式",offset:0,duration:1500});document.getElementById("func").files[0];var c=new FileReader,s=new Image,l=null;0==(l=t.target.files[0]).type.indexOf("image")&&c.readAsDataURL(l),c.onload=function(t){s.src=t.target.result};var r=document.createElement("canvas"),u=r.getContext("2d");s.onload=function(){var t=this.width,e=this.height,i=t,o=e;(t>600||e>600)&&(t/e>1?(i=600,o=Math.round(e/t*600)):(o=600,i=Math.round(t/e*600))),r.width=i,r.height=o,u.clearRect(0,0,i,o),u.drawImage(s,0,0,i,o),r.toBlob(function(t){var e,i=new FileReader;i.onload=function(t){e=t.target.result.split(",");var i=a.$loading({lock:!0,text:"Loading",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"});a.$axios.post("/product/pc/product_image/",{login_token:localStorage.getItem("token"),product_id:a.product_id,image:e[1]}).then(function(t){if(0==t.data.status){var e=window.URL.createObjectURL(document.getElementById("func").files[0]);a.uploaded.push(e);for(var o=document.getElementsByTagName("img"),n=0;n<o.length;n++){var d=o[0].width;o[n].style.height=d/1.3+"px"}i.close(),a.$notify({title:"成功",message:"上传成功",offset:0,duration:1500}),document.getElementById("func").value="",document.getElementById("func1").value=""}else a.$notify({title:"错误",message:res.data.msg,offset:0,duration:1500}),i.close()}).catch(function(t){alert("上传图片出错！"),i.close()})},i.readAsDataURL(t)},l.type||"image/png")}}}},mounted:function(){var t=this;this.product_id=this.$route.query.id,this.$axios.get("/product/product_info/"+this.$route.query.id+"/",{params:{login_token:localStorage.getItem("token")}}).then(function(e){if(0==e.data.status){var a=!0,i=!1,n=void 0;try{for(var d,c=o()(e.data.product_detail.img_list);!(a=(d=c.next()).done);a=!0){var s=d.value;t.uploaded.push(s.url)}}catch(t){i=!0,n=t}finally{try{!a&&c.return&&c.return()}finally{if(i)throw n}}var l=!0,r=!1,u=void 0;try{for(var f,p=o()(e.data.product_detail.img_list);!(l=(f=p.next()).done);l=!0){var g=f.value;t.picIds.push(g.id)}}catch(t){r=!0,u=t}finally{try{!l&&p.return&&p.return()}finally{if(r)throw u}}for(var m=document.getElementsByTagName("img"),h=0;h<m.length;h++){var v=m[0].width;m[h].style.height=v/1.3+"px"}t.form.name=e.data.product_detail.name,t.form.price=e.data.product_detail.price,t.form.standard=e.data.product_detail.standard,t.form.description=e.data.product_detail.description}else t.$notify({title:"错误",message:e.data.msg,offset:0,duration:1500})}).catch(function(t){this.$notify({title:"错误",message:"服务器繁忙",offset:0,duration:1500})})}},s={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"contain"},[a("input",{staticStyle:{display:"none"},attrs:{type:"file",id:"func"},on:{change:t.add_img}}),t._v(" "),a("input",{staticStyle:{display:"none"},attrs:{type:"file",id:"func1"},on:{change:t.change_img}}),t._v(" "),a("div",{staticClass:"upload"},[a("div",{staticClass:"upload_items"},[a("img",{attrs:{src:t.uploaded[0]?t.uploaded[0]:t.picUrl,alt:""}}),t._v(" "),t.uploaded[0]?a("div",{on:{click:function(e){t.deletePic(0)}}},[t._v("删除")]):t._e(),t._v(" "),t.uploaded[0]?a("p",{on:{click:function(e){t.change_pic(t.picIds[0],0)}}},[t._v("修改图片")]):a("p",{on:{click:function(e){t.upload_pic()}}},[t._v("上传图片")])]),t._v(" "),a("div",{staticClass:"upload_items"},[a("img",{attrs:{src:t.uploaded[1]?t.uploaded[1]:t.picUrl,alt:""}}),t._v(" "),t.uploaded[1]?a("div",{on:{click:function(e){t.deletePic(1)}}},[t._v("删除")]):t._e(),t._v(" "),t.uploaded[1]?a("p",{on:{click:function(e){t.change_pic(t.picIds[1],1)}}},[t._v("修改图片")]):a("p",{on:{click:function(e){t.upload_pic()}}},[t._v("上传图片")])]),t._v(" "),a("div",{staticClass:"upload_items"},[a("img",{attrs:{src:t.uploaded[2]?t.uploaded[2]:t.picUrl,alt:""}}),t._v(" "),t.uploaded[2]?a("div",{on:{click:function(e){t.deletePic(2)}}},[t._v("删除")]):t._e(),t._v(" "),t.uploaded[2]?a("p",{on:{click:function(e){t.change_pic(t.picIds[2],2)}}},[t._v("修改图片")]):a("p",{on:{click:function(e){t.upload_pic()}}},[t._v("上传图片")])]),t._v(" "),a("div",{staticClass:"upload_items"},[a("img",{attrs:{src:t.uploaded[3]?t.uploaded[3]:t.picUrl,alt:""}}),t._v(" "),t.uploaded[3]?a("div",{on:{click:function(e){t.deletePic(3)}}},[t._v("删除")]):t._e(),t._v(" "),t.uploaded[3]?a("p",{on:{click:function(e){t.change_pic(t.picIds[3],3)}}},[t._v("修改图片")]):a("p",{on:{click:function(e){t.upload_pic()}}},[t._v("上传图片")])]),t._v(" "),a("div",{staticClass:"upload_items"},[a("img",{attrs:{src:t.uploaded[4]?t.uploaded[4]:t.picUrl,alt:""}}),t._v(" "),t.uploaded[4]?a("div",{on:{click:function(e){t.deletePic(4)}}},[t._v("删除")]):t._e(),t._v(" "),t.uploaded[4]?a("p",{on:{click:function(e){t.change_pic(t.picIds[4],4)}}},[t._v("修改图片")]):a("p",{on:{click:function(e){t.upload_pic()}}},[t._v("上传图片")])]),t._v(" "),a("div",{staticClass:"upload_items"},[a("img",{attrs:{src:t.uploaded[5]?t.uploaded[5]:t.picUrl,alt:""}}),t._v(" "),t.uploaded[5]?a("div",{on:{click:function(e){t.deletePic(5)}}},[t._v("删除")]):t._e(),t._v(" "),t.uploaded[5]?a("p",{on:{click:function(e){t.change_pic(t.picIds[5],5)}}},[t._v("修改图片")]):a("p",{on:{click:function(e){t.upload_pic()}}},[t._v("上传图片")])])]),t._v(" "),a("div",{staticClass:"info"},[a("div",[a("el-form",{ref:"form",attrs:{model:t.form,"label-width":"80px"}},[a("el-form-item",{attrs:{label:"名 称"}},[a("el-input",{model:{value:t.form.name,callback:function(e){t.$set(t.form,"name",e)},expression:"form.name"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"价 格"}},[a("el-input",{model:{value:t.form.price,callback:function(e){t.$set(t.form,"price",e)},expression:"form.price"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"规 格"}},[a("el-input",{model:{value:t.form.standard,callback:function(e){t.$set(t.form,"standard",e)},expression:"form.standard"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"介 绍"}},[a("el-input",{attrs:{type:"textarea"},model:{value:t.form.description,callback:function(e){t.$set(t.form,"description",e)},expression:"form.description"}})],1),t._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:t.onSubmit}},[t._v("立即保存")])],1)],1)],1)])])},staticRenderFns:[]};var l=a("VU/8")(c,s,!1,function(t){a("KwcU")},"data-v-9fb2a2b8",null);e.default=l.exports},KwcU:function(t,e){}});