webpackJsonp([5],{QkSY:function(t,e){},iLJR:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=a("mvHQ"),o=a.n(i),n={data:function(){return{createFlag:!1,form:{name:"",price:"",standard:"",description:""},uploadUrl:"https://www.njhaoji.com/product/product_image/",uploaded:[],uploadedId:[],product_id:"",fullscreenLoading:!1,picUrl:"./static/img/default.jpg"}},methods:{deletePic:function(t){var e=this;this.$axios.delete("/product/product_image/"+this.uploadedId[t]+"/",{params:{login_token:localStorage.getItem("token")}}).then(function(a){0==a.data.status?(e.$notify({title:"成功",message:"删除成功",offset:0,duration:1500}),e.uploaded.splice(t,1),e.uploadedId.splice(t,1)):e.$notify({title:"错误",message:a.data.msg,offset:0,duration:1500})}).catch(function(t){this.$notify({title:"错误",message:"服务器繁忙",offset:0,duration:1500})})},cancel:function(){this.$router.go(-1)},continueSubmit:function(){for(var t in this.createFlag=!1,this.form)this.form[t]="";this.uploaded=[],this.product_id=""},onSubmit:function(){var t=this;if(this.createFlag)if(this.form.name){if(isNaN(this.form.price))return this.$notify({title:"错误",message:"商品价格请填写数字",offset:0,duration:2500}),void(this.form.price="");var e=JSON.parse(o()(this.form));e.login_token=localStorage.getItem("token"),this.$axios.post("/product/product_info/"+this.product_id+"/",e).then(function(e){0==e.data.status?t.$notify({title:"成功",message:"创建成功",offset:0,duration:1500}):t.$notify({title:"错误",message:e.data.msg,offset:0,duration:1500})}).catch(function(t){this.$notify({title:"错误",message:"服务器繁忙",offset:0,duration:1500})})}else this.$notify({title:"错误",message:"您必须填写商品名称",offset:0,duration:2500});else this.$notify({title:"错误",message:"您必须至少上传一张图片",offset:0,duration:2500})},upload_pic:function(){6!=this.uploaded.length?document.getElementById("func").click():this.$notify({title:"错误",message:"最多支持6张图片",offset:0,duration:1500})},add_img:function(t){var e=this;if(t.target.files[0].size<1e5)if(this.createFlag){new FileReader;var a=t.target.files[0];if("jpg"!=(l=a.name.substring(a.name.lastIndexOf(".")+1).toLowerCase())&&"jpeg"!=l&&"pdf"!=l&&"png"!=l&&"dwg"!=l&&"gif"!=l)return void this.$notify({title:"错误",message:"请上传图片格式",offset:0,duration:1500});var i=new FormData;i.append("image",a,a.name),i.append("login_token",localStorage.getItem("token")),i.append("product_id",this.product_id);var o=this.$loading({lock:!0,text:"Loading",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"});this.$axios.post("/product/product_image/",i,{headers:{"Content-Type":"multipart/form-data"}}).then(function(t){if(0==t.data.status){var a=window.URL.createObjectURL(document.getElementById("func").files[0]);e.uploaded.push(a),e.uploadedId.push(t.data.image_id);for(var i=document.getElementsByTagName("img"),n=0;n<i.length;n++){var d=i[0].width;i[n].style.height=d/1.3+"px"}e.createFlag=!0,o.close(),e.$notify({title:"成功",message:"上传成功",offset:0,duration:1500}),document.getElementById("func").value=""}else e.$notify({title:"错误",message:res.data.msg,offset:0,duration:1500}),o.close()}).catch(function(t){alert("上传图片出错！"),o.close()})}else{new FileReader;var n=t.target.files[0];if("jpg"!=(l=n.name.substring(n.name.lastIndexOf(".")+1).toLowerCase())&&"jpeg"!=l&&"pdf"!=l&&"png"!=l&&"dwg"!=l&&"gif"!=l)return void this.$notify({title:"错误",message:"请上传图片格式",offset:0,duration:1500});var d=new FormData;d.append("image",n,n.name),d.append("login_token",localStorage.getItem("token")),d.append("category_id",this.$route.query.id);var s=this.$loading({lock:!0,text:"Loading",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"});this.$axios.post("/product/product_image/",d,{headers:{"Content-Type":"multipart/form-data"}}).then(function(t){if(0==t.data.status){var a=window.URL.createObjectURL(document.getElementById("func").files[0]);e.uploaded.push(a),e.uploadedId.push(t.data.image_id);for(var i=document.getElementsByTagName("img"),o=0;o<i.length;o++){var n=i[0].width;i[o].style.height=n/1.3+"px"}e.createFlag=!0,e.product_id=t.data.product_id,s.close(),e.$notify({title:"成功",message:"上传成功",offset:0,duration:1500}),document.getElementById("func").value=""}else e.$notify({title:"错误",message:res.data.msg,offset:0,duration:1500}),s.close()}).catch(function(t){alert("上传图片出错！"),s.close()})}else{var l,c=this,r=t.target.files[0];if("jpg"!=(l=r.name.substring(r.name.lastIndexOf(".")+1).toLowerCase())&&"jpeg"!=l&&"pdf"!=l&&"png"!=l&&"dwg"!=l&&"gif"!=l)return void this.$notify({title:"错误",message:"请上传图片格式",offset:0,duration:1500});document.getElementById("func").files[0];var u=new FileReader,f=new Image,p=null;0==(p=t.target.files[0]).type.indexOf("image")&&u.readAsDataURL(p),u.onload=function(t){f.src=t.target.result};var m=document.createElement("canvas"),g=m.getContext("2d");f.onload=function(){var t=this.width,e=this.height,a=t,i=e;(t>600||e>600)&&(t/e>1?(a=600,i=Math.round(e/t*600)):(i=600,a=Math.round(t/e*600))),m.width=a,m.height=i,g.clearRect(0,0,a,i),g.drawImage(f,0,0,a,i),m.toBlob(function(t){var e,a=new FileReader;a.onload=function(t){e=t.target.result.split(",");var a=c.$loading({lock:!0,text:"Loading",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"});c.createFlag?c.$axios.post("/product/pc/product_image/",{login_token:localStorage.getItem("token"),product_id:c.product_id,image:e[1]}).then(function(t){if(0==t.data.status){var e=window.URL.createObjectURL(document.getElementById("func").files[0]);c.uploaded.push(e),c.uploadedId.push(t.data.image_id);for(var i=document.getElementsByTagName("img"),o=0;o<i.length;o++){var n=i[0].width;i[o].style.height=n/1.3+"px"}c.createFlag=!0,a.close(),c.$notify({title:"成功",message:"上传成功",offset:0,duration:1500}),document.getElementById("func").value=""}else c.$notify({title:"错误",message:res.data.msg,offset:0,duration:1500}),a.close()}).catch(function(t){alert("上传图片出错！"),a.close()}):c.$axios.post("/product/pc/product_image/",{login_token:localStorage.getItem("token"),category_id:c.$route.query.id,image:e[1]}).then(function(t){if(0==t.data.status){var e=window.URL.createObjectURL(document.getElementById("func").files[0]);c.uploaded.push(e),c.uploadedId.push(t.data.image_id);for(var i=document.getElementsByTagName("img"),o=0;o<i.length;o++){var n=i[0].width;i[o].style.height=n/1.3+"px"}c.createFlag=!0,c.product_id=t.data.product_id,a.close(),c.$notify({title:"成功",message:"上传成功",offset:0,duration:1500}),document.getElementById("func").value=""}else c.$notify({title:"错误",message:res.data.msg,offset:0,duration:1500}),a.close()}).catch(function(t){alert("上传图片出错！"),a.close()})},a.readAsDataURL(t)},p.type||"image/png")}}}},mounted:function(){}},d={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"contain"},[a("input",{staticStyle:{display:"none"},attrs:{type:"file",id:"func"},on:{change:t.add_img}}),t._v(" "),a("div",{staticClass:"upload"},[a("div",{staticClass:"upload_items"},[a("img",{attrs:{src:t.uploaded[0]?t.uploaded[0]:t.picUrl,alt:""}}),t._v(" "),t.uploaded[0]?a("div",{on:{click:function(e){t.deletePic(0)}}},[t._v("删除")]):t._e(),t._v(" "),a("p",{on:{click:function(e){t.upload_pic()}}},[t._v("上传图片")])]),t._v(" "),a("div",{staticClass:"upload_items"},[a("img",{attrs:{src:t.uploaded[1]?t.uploaded[1]:t.picUrl,alt:""}}),t._v(" "),t.uploaded[1]?a("div",{on:{click:function(e){t.deletePic(1)}}},[t._v("删除")]):t._e(),t._v(" "),a("p",{on:{click:function(e){t.upload_pic()}}},[t._v("上传图片")])]),t._v(" "),a("div",{staticClass:"upload_items"},[a("img",{attrs:{src:t.uploaded[2]?t.uploaded[2]:t.picUrl,alt:""}}),t._v(" "),t.uploaded[2]?a("div",{on:{click:function(e){t.deletePic(2)}}},[t._v("删除")]):t._e(),t._v(" "),a("p",{on:{click:function(e){t.upload_pic()}}},[t._v("上传图片")])]),t._v(" "),a("div",{staticClass:"upload_items"},[a("img",{attrs:{src:t.uploaded[3]?t.uploaded[3]:t.picUrl,alt:""}}),t._v(" "),t.uploaded[3]?a("div",{on:{click:function(e){t.deletePic(3)}}},[t._v("删除")]):t._e(),t._v(" "),a("p",{on:{click:function(e){t.upload_pic()}}},[t._v("上传图片")])]),t._v(" "),a("div",{staticClass:"upload_items"},[a("img",{attrs:{src:t.uploaded[4]?t.uploaded[4]:t.picUrl,alt:""}}),t._v(" "),t.uploaded[4]?a("div",{on:{click:function(e){t.deletePic(4)}}},[t._v("删除")]):t._e(),t._v(" "),a("p",{on:{click:function(e){t.upload_pic()}}},[t._v("上传图片")])]),t._v(" "),a("div",{staticClass:"upload_items"},[a("img",{attrs:{src:t.uploaded[5]?t.uploaded[5]:t.picUrl,alt:""}}),t._v(" "),t.uploaded[5]?a("div",{on:{click:function(e){t.deletePic(5)}}},[t._v("删除")]):t._e(),t._v(" "),a("p",{on:{click:function(e){t.upload_pic()}}},[t._v("上传图片")])])]),t._v(" "),a("div",{staticClass:"info"},[a("div",[a("el-form",{ref:"form",attrs:{model:t.form,"label-width":"80px"}},[a("el-form-item",{attrs:{label:"名 称"}},[a("el-input",{attrs:{placeholder:"此项为必填项"},model:{value:t.form.name,callback:function(e){t.$set(t.form,"name",e)},expression:"form.name"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"价 格"}},[a("el-input",{attrs:{placeholder:"此项为非必填项"},model:{value:t.form.price,callback:function(e){t.$set(t.form,"price",e)},expression:"form.price"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"规 格"}},[a("el-input",{attrs:{placeholder:"此项为非必填项"},model:{value:t.form.standard,callback:function(e){t.$set(t.form,"standard",e)},expression:"form.standard"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"介 绍"}},[a("el-input",{attrs:{type:"textarea",placeholder:"此项为非必填项"},model:{value:t.form.description,callback:function(e){t.$set(t.form,"description",e)},expression:"form.description"}})],1),t._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:t.onSubmit}},[t._v("立即保存")]),t._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:function(e){t.continueSubmit()}}},[t._v("继续创建")]),t._v(" "),a("el-button",{on:{click:function(e){t.cancel()}}},[t._v("取消")])],1)],1)],1)])])},staticRenderFns:[]};var s=a("VU/8")(n,d,!1,function(t){a("QkSY")},"data-v-67878a95",null);e.default=s.exports}});